name: Test Slack Notification

on:
  workflow_dispatch:
    inputs:
      test_scenario:
        description: 'Test scenario'
        required: true
        type: choice
        options:
          - format-failure
          - test-failure
          - both-failure
          - success

jobs:
  test-notify:
    name: Test Slack Notification
    runs-on: ubuntu-latest

    steps:
      - name: Simulate failed jobs
        id: failed-jobs
        run: |
          if [ "${{ inputs.test_scenario }}" == "format-failure" ]; then
            echo "failures=- í¬ë§·íŒ… í•„ìš”" >> $GITHUB_OUTPUT
          elif [ "${{ inputs.test_scenario }}" == "test-failure" ]; then
            echo "failures=- Tests ì‹¤íŒ¨" >> $GITHUB_OUTPUT
          elif [ "${{ inputs.test_scenario }}" == "both-failure" ]; then
            echo "failures=- í¬ë§·íŒ… í•„ìš”\n- Tests ì‹¤íŒ¨" >> $GITHUB_OUTPUT
          else
            echo "failures=- ëª¨ë“  ì²´í¬ í†µê³¼" >> $GITHUB_OUTPUT
          fi

      - name: Send Slack notification
        uses: slackapi/slack-github-action@v2.1.1
        with:
          method: chat.postMessage
          token: ${{ secrets.SLACK_BOT_TOKEN }}
          payload: |
            channel: ${{ secrets.SLACK_GIT_NOTIFY_CHANNEL_ID }}
            text: "ğŸ§ª [TEST] main ë¸Œëœì¹˜ CI ì‹¤íŒ¨"
            blocks:
              - type: header
                text:
                  type: plain_text
                  text: "ğŸ§ª TEST: Production ë°°í¬ ì°¨ë‹¨"
              - type: section
                text:
                  type: mrkdwn
                  text: "<!channel> *main* ë¸Œëœì¹˜ CI ì‹¤íŒ¨ (í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€)"
              - type: section
                fields:
                  - type: mrkdwn
                    text: "*Author*\n@${{ github.actor }}"
                  - type: mrkdwn
                    text: "*ì‹¤íŒ¨ ì›ì¸*\n${{ steps.failed-jobs.outputs.failures }}"
                  - type: mrkdwn
                    text: "*ì‹œë‚˜ë¦¬ì˜¤*\n${{ inputs.test_scenario }}"
                  - type: mrkdwn
                    text: "*ì‹¤í–‰ ì‹œê°*\n${{ github.event.repository.updated_at }}"
              - type: actions
                elements:
                  - type: button
                    text:
                      type: plain_text
                      text: "Workflow í™•ì¸"
                    url: "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
              - type: context
                elements:
                  - type: mrkdwn
                    text: "âš ï¸ ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ì…ë‹ˆë‹¤"
