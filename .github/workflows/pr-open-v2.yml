name: PR Open Setting

on:
  pull_request:
    types: [opened, reopened]

jobs:
  update-project:
    runs-on: ubuntu-latest
    steps:
      # 1. GitHub App Token ìƒì„±
      - name: Generate GitHub App Token
        id: generate-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ secrets.CARO_BACKEND_APP_ID }}
          private-key: ${{ secrets.CARO_BACKEND_APP_PRIVATE_KEY }}

      # 2. PRì„ í”„ë¡œì íŠ¸ì— ì¶”ê°€ (Built-in Automationë¡œ ì§„í–‰)
#      - name: Add PR to Project
#        id: add-to-project
#        uses: actions/add-to-project@v1.0.2
#        with:
#          project-url: ${{ secrets.PROJECT_URL }}
#          github-token: ${{ steps.generate-token.outputs.token }}

      # 3. í”„ë¡œì íŠ¸ ìƒíƒœë¥¼ "ğŸ”„In progress"ë¡œ ì„¤ì •
      - name: Set Status to In progress
        uses: github/update-project-action@v3
        with:
          github_token: ${{ steps.generate-token.outputs.token }}
          organization: ${{ github.repository_owner }}
          project_number: ${{ secrets.PROJECT_NUMBER }}
          content_id: ${{ github.event.pull_request.node_id }}
          field: Status
          value: ğŸ”„In progress

      # 4. í”„ë¡œì íŠ¸ ì‹œì‘ ë‚ ì§œ ì„¤ì •
      - name: Set Start Date
        uses: github/update-project-action@v3
        with:
          github_token: ${{ steps.generate-token.outputs.token }}
          organization: ${{ github.repository_owner }}
          project_number: ${{ secrets.PROJECT_NUMBER }}
          content_id: ${{ github.event.pull_request.node_id }}
          field: Start date
          value: ${{ github.event.pull_request.created_at }}
